<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
    <title>Typing Tutor Game</title>
        <link href="assets/css/style.css" rel="stylesheet">
</head>
<body>
    <div class="navbar">
        <a href="https://arynchoong.github.io/aryn/"><img src="assets/images/aryn-straight.png"></a>
        <span class="navbar-text">Typing Tutor</span>
        <div class="dropdown">
            <button class="dropbtn" onclick="window.location.href='../index.html'">Game &#9662;</a></button>
            <div class="dropdown-content">
            <a href="py01_scrape_words.html">Scrape Words</a>
            <a href="py02_pygame.html">PyGame</a>
            <a href="py03_game_loop.html">Game Loop</a>
            <a href="py04_display_text.html">Text</a>
            <a href="py05_keypress.html">Keypress</a>
            <a href="py06_game_object.html">Objects</a>
            <a href="py07_draw_playing.html">Play</a>
            <a href="py08_animate.html">Animate</a>
            <a href="py09_user_typing.html">Typing</a>
            <a >Cityline</a>
            <a href="py11_level_up.html">Levels</a>
            <a href="py12_sound.html">Sound</a>
            </div>
        </div>
        <a href="py11_level_up.html" class="navbar-right">&#x27A1;</a>
        <span class="navbar-right">Cityline</span>
        <a href="py09_user_typing.html" class="navbar-right">&#x2B05;</a>
    </div>
    <div class="page">
    <article>
        <h1>Typing Tutor Game</h1>
<h2>City Line</h2>

<p>The last object is our city blocks at the bottom of the screen.</p>
<p>I like to call it the cityline because we can draw it it as a contiguous line at the bottom of the screen.</p>

<p>And it is not neccesaary to keep track of every pixel of the line, we can just consider every 10 pixel block.</p>


<div class="flex-container"><div class="box">
<p>Let us create our blocks and city iterator and put it in a new script <b>city.py</b>. First our city line that will hold our city blocks in a list:
</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="k">class</span> <span class="f">Cityline</span>:
    <span class="k">def</span> <span class="f">__init__</span>(self, screen_width):
        self.len <span class="ow">=</span> <span class="nb">int</span>(screen_width<span class="ow">/</span><span class="nb">10</span>)
        self.cityline <span class="ow">=</span> []</pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>And our blocks will have randomly assigned building height, and a flag to indicate its presence or destroyed:
</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="k">class</span> <span class="f">Block</span>:
    <span class="k">def</span> <span class="f">__init__</span>(self, flag<span class="ow">=</span><span class="k">True</span>, height <span class="ow">=</span> <span class="nb">0</span>):
        self.flag <span class="ow">=</span> flag
        self.height <span class="ow">=</span> height</pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>We can then randomise the height of each block on initialise of Cityline:
</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="k">class</span> <span class="f">Cityline</span>:
    <span class="k">def</span> <span class="f">__init__</span>(self, screen_width):
        self.len <span class="ow">=</span> <span class="nb">int</span>(screen_width<span class="ow">/</span><span class="nb">10</span>)
        self.cityline <span class="ow">=</span> []
<div class="diff">        <span class="k">for</span> i <span class="k">in</span> <span class="nb">range</span>(self.len):
            self.cityline.append(Block(<span class="k">True</span>, random.randint(<span class="nb">1</span>,<span class="nb">20</span>)))
        self.cityline[<span class="nb">-1</span>].set_flag(<span class="k">False</span>)</div></pre></div>
</div></div>

<p>We set the last block to be false, so that we do not draw indifinitely, as each block we require start x and end x, which gives us n-1 blocks with cityline of n size.
</p>
<h2>Iterator</h2>

<div class="flex-container"><div class="box">
<p>Because our cityline consists of a list of objects, we need to build in our object an iterator to access each block. 
</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="k">class</span> <span class="f">Cityline</span>:
    <span class="k">def</span> <span class="f">__iter__</span>(self):
        <span class="k">return</span> CityIterator(self.cityline)
    <span class="k">def</span> <span class="f">__len__</span>(self):
        <span class="k">return</span> self.len</pre></div>

    <div class="code">
<pre><span class="k">class</span> <span class="f">CityIterator</span>:
    <span class="k">def</span> <span class="f">__init__</span>(self, city):
        self.city <span class="ow">=</span> city
        self.index <span class="ow">=</span> <span class="nb">0</span>
    
    <span class="k">def</span> <span class="f">__next__</span>(self):
        <span class="k">try</span>:
            block <span class="ow">=</span> self.city[self.index]
        <span class="k">except</span> IndexError:
            <span class="k">raise</span> StopIteration()
        self.index <span class="ow">+=</span> <span class="nb">1</span>
        <span class="k">return</span> block
    
    <span class="k">def</span> <span class="f">__iter__</span>(self):
        <span class="k">return</span> self</pre></div>
</div></div>

<h2>Collision</h2>

<p>Remember our y boundary is 40 pixels from screen bottom. So we just need to create method for our game play to call whenever a word goes below the height of our city block.
</p>
<div class="flex-container"><div class="box">
<p>So we need a method to remove the block/blocks that are hit :
</p>
</div><div class="boxes">
    <div class="code">
<pre>    <span class="k">def</span> <span class="f">del_blocks</span>(self, startx, strlen):
        startidx <span class="ow">=</span> <span class="nb">int</span>((startx-<span class="cn">MARGINX</span>) <span class="ow">/</span> <span class="nb">10</span>)
        endidx <span class="ow">=</span> (startidx <span class="ow">+</span> <span class="nb">int</span>((<span class="cn">FONTWIDTH</span> <span class="ow">*</span> strlen) <span class="ow">/</span> <span class="nb">10</span>))
        <span class="k">if</span> endidx <span class="ow">>=</span> self.len:
            endidx <span class="ow">=</span> self.len<span class="ow">-</span><span class="nb">1</span>
        <span class="k">for</span> i <span class="k">in</span> <span class="nb">range</span>(startidx, endidx<span class="ow">+</span><span class="nb">1</span>):
            self.cityline[i].set_flag(<span class="k">False</span>)</pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>And we need a method to check if all city blocks are destroyed:
</p>
</div><div class="boxes">
    <div class="code">
<pre>    <span class="k">def</span> <span class="f">check_gameover</span>(self):
        <span class="k">if</span> <span class="nb">all</span>(block.get_flag() <span class="ow">==</span> <span class="k">False</span> <span class="k">for</span> block <span class="k">in</span> self.cityline):
            <span class="k">return</span> <span class="k">True</span>
        <span class="k">return</span> <span class="k">False</span></pre></div>
</div></div>

<h2>Render cityline</h2>

<div class="flex-container"><div class="box">
<p>Now that we have our cityline object ready, we just need to add to our game objects:
</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># objects.py</span>
<span class="k">from</span> city <span class="k">import</span> Cityline

<span class="k">class</span> <span class="f">Objects</span>:
<div class="diff">    <span class="k">def</span> <span class="f">__init__</span>(self, screen_width, screen_height):
        self.cityline <span class="ow">=</span> Cityline(screen_width)</div></pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>And remember to add screen width to objects instantiation:</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># play.py</span>
    <span class="k">def</span> <span class="f">on_init</span>(self):
<div class="diff">        self.game_objects = Objects(self.width, self._display_surf.get_height())
</div></pre></div>
</div></div>

<div class="flex-container"><div class="box">
<p>And add to our draw method:
</p>
</div><div class="boxes">
    <div class="code">
<pre>   <span class="k">def</span> <span class="f">on_render</span>(self):
        self._display_surf.fill(<span class="cn">BLUE</span>)
        base_y <span class="ow">=</span> self.height <span class="ow">-</span> <span class="nb">30</span>
<div class="diff">        <span class="c"># cityline</span>
        <span class="k">for</span> i <span class="k">in</span> <span class="nb">range</span>(<span class="nb">len</span>(self.game_objects.cityline)):
            block <span class="ow">=</span> self.game_objects.cityline.get_block(i)
            <span class="k">if</span> (block.get_flag()<span class="ow">==</span><span class="k">False</span>):
                <span class="k">continue</span>
            startx <span class="ow">=</span> (i*<span class="nb">10</span>) + <span class="cn">MARGINX</span>
            starty <span class="ow">=</span> base_y <span class="ow">+</span> block.get_height()
            endx <span class="ow">=</span> ((i<span class="ow">+</span><span class="nb">1</span>)*<span class="nb">10</span>) <span class="ow">+</span> <span class="cn">MARGINX</span>
            endy <span class="ow">=</span> base_y <span class="ow">+</span> self.game_objects.cityline.get_block(i 
                        <span class="ow">+</span> <span class="nb">1</span>).get_height()
            pygame.draw.lines(self._display_surf, <span class="cn">LIGHTBLUE</span>, <span class="k">False</span>,
                             [(startx,starty), (startx,endy), 
                             (endx,endy)], <span class="nb">3</span>)
</div></pre></div>
</div></div>

<h2>Check collision</h2>

<div class="flex-container"><div class="box">
<p>Where we check for words falling below the y boundary, we need to remove the corresponding city block, in <b>objects.py</b>
</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># objects.py</span>
    <span class="k">def</span> <span class="f">move</span>(self, delta):
        removed_typing <span class="ow">=</span> <span class="k">False</span>
        <span class="k">if</span> <span class="k">not</span> self.game_words:
            
        <span class="k">for</span> word <span class="k">in</span> self.game_words:
            word.move(delta)
            <span class="c"># check y boundary</span>
            <span class="k">if</span> word.get_y() <span class="ow">>=</span> self.bound_y:
                <span class="k">if</span> word.typedidx <span class="ow">>=</span> <span class="nb">0</span>:
                    removed_typing <span class="ow">=</span> <span class="k">True</span>
                word.set_remove()
<div class="diff">                self.cityline.del_blocks(word.get_x(), <span class="nb">len</span>(word))
</div>        self.cleanup()
        <span class="k">return</span> removed_typing</pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>And to check for game over in <b>play.py</b>
</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># play.py</span>
    <span class="k">def</span> <span class="f">on_loop</span>(self):
<div class="diff">        <span class="k">if</span> self.game_objects.is_gameover():
            self.state <span class="ow">=</span> <span class="cn">GAMEOVER</span>
            <span class="k">return</span>
</div>        <span class="k">if</span> self.game_objects.move(self.ydelta):
            self.typingflag <span class="ow">=</span> <span class="k">False</span>
        self.add_word()
</pre></div>
</div></div>
    </article>
    </div>
</body>
<footer>
    <p class="footer">Copyright © 2019 Aryn Choong. All Rights Reserved.</p>
</footer>
</html>