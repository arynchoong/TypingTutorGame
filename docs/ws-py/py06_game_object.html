<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
    <title>Typing Tutor Game</title>
        <link href="assets/css/style.css" rel="stylesheet">
        <script src="assets/js/script.js"></script>
</head>
<body>
    <div class="navbar" id="topNav">
        <a href="https://arynchoong.com" style="padding:0;"><img src="assets/images/aryn-straight.png"></a>
        <a href="../index.html">Typing Tutor</a>
        <div class="dropdown">
        <button class="dropbtn" onclick="addResponsive()">Game &#9662;</button>
        <div class="dropdown-content">
            <a href="py01_scrape_words.html">Scrape Words</a>
            <a href="py02_pygame.html">PyGame</a>
            <a href="py03_game_loop.html">Game Loop</a>
            <a href="py04_display_text.html">Text</a>
            <a href="py05_keypress.html">Keypress</a>
            <a class="active">Objects</a>
            <a href="py07_draw_playing.html">Play</a>
            <a href="py08_animate.html">Animate</a>
            <a href="py09_user_typing.html">Typing</a>
            <a href="py10_cityline.html">Cityline</a>
            <a href="py11_level_up.html">Levels</a>
            <a href="py12_sound.html">Sound</a>
            </div>
        </div>
        <a href="javascript:void(0);" class="icon" onclick="addResponsive()">&#9776;</a>
    </div>

    <div class="page">
    <article>
        <h1>Typing Tutor Game</h1>
<h2>Game object - words</h2>
<div class="flex-container"><div class="box">
<p>Now that we have our game loop, let's introduce our words to our game play display.</p>

<p>First, let's create our game objects class in a different script called <b>objects.py</b>, that initialises our wordlist with our gutenberg words we have scraped.</p>

</div><div class="boxes">
    <div class="code">
<pre># game objects.py
import string
import random

# Dimensions
MARGINX = 5
FONTWIDTH = 9 # based on Consolas Bold 16 pt font size

class GameObjects:
    def __init__(self, screen_width, screen_height):
        self.screen_width = screen_width
        self.screen_height = screen_height
        self.wordlist = self.init_words()
        self.game_words = []
        self.bound_y = screen_height - 40

    def init_words(self):
        words_list = None
        try:
            with open("words.txt", 'r', newline='') as file:
                words_list = [line.strip() for line in file.readlines()]
        except:
            # Error handling, provide default:
            words_list = list(string.ascii_letters)
            random.shuffle(words_list)
        return words_list</pre></div>
</div></div>

<h2>Initialise words</h2>

<div class="flex-container"><div class="box">
<p>And initialise our game objects at init of game play, in <b>play.py</b>:</p>
</p>
</div><div class="boxes">
    <div class="code">
<pre>
# play.py
import pygame
<div class="diff">from objects import GameObjects</div>
 . 
 . 
 . 
        self.font =  pygame.font.Font('Consolas Bold.ttf', 16)
        self.playing = True
<div class="diff">        self.game_objects = GameObjects(self.width, self.height)</div></pre></div>
</div></div>


<h2>Adding words</h2>

<div class="flex-container"><div class="box">
<p>We want to drop the words in regular intervals from top of the screen, and as such we need a clock.</p>
<p>And also drop immediately if there is no other words on screen.</p>
<p>First, let's create our game play loop, <b>play.py</b>:</p>
</div><div class="boxes">
    <div class="code">
<pre>    def check_events(self):
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                pygame.quit()
<div class="diff">            elif event.type == pygame.TEXTINPUT:
                self.keyhit = event.text
</div>            elif event.type == pygame.KEYUP:
                if event.key == pygame.K_ESCAPE:
                    self.playing = False
        return

    def loop(self):
<div class="diff">        self.check_keyhit()
        return

    def check_keyhit(self):
        # TODO: check our keyhit here
</div>        return</pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>Then we add to that our game words object, where we keep track of the current words at play:</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># objects.py</span>
<span class="k">from</span> word <span class="k">import</span> Word

<span class="k">class</span> <span class="f">Objects</span>:
    <span class="k">def</span> <span class="f">__init__</span>(self):
        self.wordlist <span class="ow">=</span> self.init_words()
<div class="diff">        self.game_words <span class="ow">=</span> []</div></pre></div>
</div></div>
<br><div class="flex-container"><div class="box">
<p>In the list of game words, we want to keep track of the words we have during game play. And so we create our word object:</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># word.py</span>

<span class="k">class</span> <span class="f">Word</span>:
    <span class="k">def</span> <span class="f">__init__</span>(self, word):
        self.text <span class="ow">=</span> word</pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>The length of the word is very important, so let's us set our <code>__len__</code> special method.</p>
<p>We also want to set our x and y coordinate for our word on initialisation, the x coordinate will be fixed for the word through it's lifespan.</p>
<p>The initalised value of y will always be on the top of the screen. Let's drop from 20 pixels.</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># word.py</span>

<span class="cn">STARTY</span> <span class="ow">=</span> <span class="nb">20</span>

<span class="k">class</span> <span class="f">Word</span>:
    <span class="k">def</span> <span class="f">__init__</span>(self, word, x):
        self.text <span class="ow">=</span> word
<div class="diff">        self.len <span class="ow">=</span> <span class="nb">len</span>(self.text)
        self._x <span class="ow">=</span> x
        self._y <span class="ow">=</span> <span class="cn">STARTY</span>
    
    <span class="k">def</span> <span class="f">__len__</span>(self):
        <span class="k">return</span> self.len
    
    <span class="k">def</span> <span class="f">get_x</span>(self):
        <span class="k">return</span> self._x

    <span class="k">def</span> <span class="f">get_y</span>(self):
        <span class="k">return</span> self._y
    </div></pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>Let's also add a method to return the coordinates. Since it would be required in order to draw the word.</p>
</div><div class="boxes">
    <div class="code">
<pre>    <span class="k">def</span> <span class="f">get_y</span>(self):
        <span class="k">return</span> self._y

<div class="diff">    <span class="k">def</span> <span class="f">coord</span>(self):
        <span class="k">return</span> self._x, self._y
    </div></pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>To set the text of the word, we want to randomly select one from our wordlist. So, we want to create a method to do so in our <b>ojects.py</b>, to add a word to our game word list, and additionally check that there is no duplicate first character in current word list.</p>
</div><div class="boxes">
    <div class="code">
<pre># objects.py

    def add_word(self):
        '''Add word to game play'''
        # Check that word doesn't duplicate first character in list
        word = random.choice(self.wordlist)
        firstchar = [word.text[0] for word in self.game_words]
        while word[0] in firstchar:
        word = random.choice(self.wordlist)</pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>And we can calculate the X margins and font width and randomly select our word's x coordinate, which will be fixed for each word's life time :</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># objects.py</span>

<div class="diff"><span class="cn">MARGINX</span> <span class="ow">=</span> <span class="nb">5</span>
<span class="cn">FONTWIDTH</span> <span class="ow">=</span> <span class="nb">9</span> <span class="c"># based on Consolas Bold 16 pt font size</span></div></pre></div><div class="code">
<pre>    def add_word(self):
        '''Add word to game play'''
        # Check that word doesn't duplicate first character in list
        word = random.choice(self.wordlist)
        firstchar = [word.text[0] for word in self.game_words]
        while word[0] in firstchar:
        word = random.choice(self.wordlist)
        
<div class="diff">        # Calculate the max of x position of word
        max_x = (self.screen_width - MARGINX) - (FONTWIDTH * len(word))

        # Some randomised fun
        x = random.randint(MARGINX,max_x)
        self.game_words.append(Word(word, x))
        return True</div></pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>Lastly, we want to control the timing we add the words.</p>
<p>So, let us add a timeout to our <b>play.py</b></p>
</div><div class="boxes">
    <div class="code">
<pre>
<span class="k">class</span> <span class="f">GamePlay</span>():
    <span class="k">def</span> <span class="f">__init__</span>(self, display_surf):
        self.width, self.height = screen.get_size()
        self.font =  pygame.font.Font(RESFOLDER + 'Consolas Bold.ttf', 16)
        self.playing = True
        self.game_objects = GameObjects(self.width, self.height)
<div class="diff">        self.last_add = 0 # time of adding word
        self.add_timeout = 2000 # 2 seconds
        self.fps = 25
        self.fpsclock = pygame.time.Clock()
        self.ydelta = 1
        self.typing_flag = False
        self.score = 0
        self.keyhit = None</div></pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>And we can create a wrapper method to check for the timeout before calling Objects.add_word()</p>
</div><div class="boxes">
    <div class="code">
<pre># play.py
    def add_word(self):
        # Check if valid to add
        if not self.game_objects.game_words or (
            (pygame.time.get_ticks() - self.last_add) > self.add_timeout):
            if self.game_objects.add_word():
                self.last_add = pygame.time.get_ticks()
        return</pre></div>
</div></div>
<br><div class="flex-container"><div class="box">
<p>We can now add our game loop, with checking of events same as our main loop for now.</p>
</div><div class="boxes">
    <div class="code">
<pre><span class="c"># play.py</span>
 . 
 . 
 .  
    def loop(self):
<div class="diff">        self.check_keyhit()
        if self.game_objects.move(self.ydelta): # If moved beyond boundary Y
            self.typing_flag = False
        self.add_word()
        return</div></pre></div>
</div></div>

<br>

<div class="flex-container"><div class="box">
<p>And read and update the main loop:</p>
</div><div class="boxes">
    <div class="code">
<pre><pre><span class="c"># game.py</span>
    def execute(self):
        # Event loop
        while self.running:
            self.check_event()
            self.render()
            if self.state == PLAYING:
<div class="diff">                self.game = GamePlay(self.screen)
                self.game.execute()
</div>                self.state += 1
            else:
                self.render()
        return</pre></div>
</div></div>
    </article>
    </div>

    <div class="navbar-bottom">
        <a href="py05_keypress.html" class="nav-left">&#x2B05;</a>
        <a href="py07_draw_playing.html" class="nav-right">&#x27A1;</a>
    </div>
    <script src="assets/js/py_syntax_highlight.js"></script>
</body>
<footer>
    <p class="footer">Copyright © 2019 Aryn Choong. All Rights Reserved.</p>
</footer>
</html>